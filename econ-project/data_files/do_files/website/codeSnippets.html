<script src="~/Users/Dropbox/shay/ShaySite/highlight/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><body>
<pre class="stata" id="CLEANDATA.do"><code>
**************************************************************<br/>
*  Relationship between Domestic Violence  and work in India *<br/>
*  by Shay Culpepper with much help from Prabal De           *<br/>
*  City College of New York                                  *<br/>
**************************************************************<br/>
<br/>
clear<br/>
capture log close<br/>
cd "~/Dropbox/"<br/>
<br/>
**************************************************************<br/>
*  INDEX<br/>
**************************************************************<br/>
<br/>
* 1.   DEPENDENT VARIABLES   : (y#)   Labor Force Participation<br/>
* 2.a  INDEPENDENT VARIABLES : (xi#)  Individual Level<br/>
* 2.b  INDEPENDENT VARIABLES : (xs#)  Spouse Level<br/>
* 2.c  INDEPENDENT VARIABLES : (xh#)  Household Level<br/>
* 2.d  INDEPENDENT VARIABLES : (xdv#) Women's Questions<br/>
* 2.e  INDEPENDENT VARIABLES : (xv#)  Village Level<br/>
*      MERGE DATA<br/>
* 3    DESCRIPTIVES<br/>
* 4    REGRESSIONS<br/>
<br/>
*************************************************************<br/>
** 1. DEPENDENT VARIABLES : Labor Force Participation<br/>
*************************************************************<br/>
use "dtas/individual.dta", clear<br/>
<br/>
** y1 : Did this person work?  <br/>
  gen work__any = 0<br/>
  recode AN6 (. = 0) (1 = 0) (2/3 = 1), gen (AN6b)<br/>
<br/>
  foreach var of varlist FM29 NF17 NF26 NF8 WS5A AN6b {<br/>
    * Remove missing observations<br/>
    recode `var' (. = 0) (-5/-1 = .) (1/365=1), gen(`var'b)<br/>
    replace work__any = 1 if `var'b == 1<br/>
    local label : variable label `var'<br/>
    la var `var'b `"Binary: `label''"'<br/>
  }<br/>
<br/>
  gen work_bus = 0 if (NF17 != .) | (NF26!= .) | (NF8b != .)<br/>
  replace work_bus = 1 if NF17b > 0 | NF26b > 0 | NF8b > 0<br/>
<br/>
  ren FM29b work_farm<br/>
  ren WS5Ab work_wage<br/>
  ren AN6b work_animal<br/>
<br/>
  gen work_home = max(work_farm, work_animal, work_bus)<br/>
  gen work_outside = work_wage<br/>
  gen work_none = min(1-work_outside, 1-work_home)<br/>
  <br/>
** y2 : Hours worked<br/>
  foreach var of varlist FM29 FM30 ///<br/>
  NF17 NF18 NF26 NF27 NF8 NF9 WS6YEAR {<br/>
    recode `var' (. = 0) (-5/-1 = .), gen(`var't)<br/>
    local label : variable label `var'<br/>
    la var `var't `"`label'"'<br/>
  }<br/>
  gen work_hours = FM29t*FM30t + NF17t*NF18t + NF26t*NF27t ///<br/>
    + NF8t*NF9t + WS6YEARt<br/>
    <br/>
** y3 : Full-time/Part-time<br/>
  recode work_hours (0=0)(1/1250=1)(1250/9850=0), gen(work_parttime)<br/>
  recode work_hours (0=0)(1/1250=0)(1250/9850=1), gen(work_fulltime)<br/>
  recode work_hours (0=0)(1/1250=1)(1250/9850=2), gen(work_partfulltime)<br/>
  label define partfull 0 "No work" 1 "Part-time" 2 "Full-time"<br/>
  label values work_partfulltime partfull<br/>
<br/>
** y4 : Salary<br/>
recode WS8ANNUAL (. = 0), gen(work_earnings)<br/>
<br/>
** Labeling Variables<br/>
la var work__any         "y1 : Any work?"<br/>
la var work_animal       "y1 : Work with animals?"<br/>
la var work_bus          "y1 : Work in a household business?"<br/>
la var work_farm         "y1 : Work on the farm?"<br/>
la var work_wage         "y1 : Work for wages or salary?"<br/>
la var work_home         "y1 : Work at home?"<br/>
la var work_outside      "y1 : Work outside of the home?"<br/>
la var work_none         "y1 : No work?"<br/>
la var work_hours        "y2 : Hours worked"<br/>
la var work_parttime     "y3 : Part-time worker"<br/>
la var work_fulltime     "y3 : Full-time worker"<br/>
la var work_partfulltime "y3 : Part/Full-time worker"<br/>
la var work_earnings     "y4 : Salary"<br/>
<br/>
****************************************************************<br/>
** 2.A INDEPENDENT VARIABLES : Individual Level<br/>
****************************************************************<br/>
<br/>
** xi1 : Age<br/>
  gen age = RO5<br/>
  gen age_sq = age^2<br/>
<br/>
** xi2 : Education Level<br/>
  recode ED5 HHED5ADULT HHED5F HHED5M (-7/-1 =.)             ///<br/>
    (0=0 "xi2: No school") (1/5=1 "xi2: Primary")            ///<br/>
    (6/10=2 "xi2: Upper Primary")(11/12=3 "xi2: Secondary")  ///<br/>
    (13/15=4 "xi2: Higher"),                                 ///<br/>
    gen(edu_levels highestedu highesteduf highestedum) label(edu)<br/>
<br/>
  recode edu_levels (0/3=0)(4=1), gen(edu_anycollege)<br/>
  recode ED5 (-7/-1 =.)(0/14=0)(15=1), gen(edu_collegegrad)<br/>
<br/>
  gen edu_current =  .<br/>
  replace edu_current = 0 if ED3 == 0<br/>
  replace edu_current = ED4 if ED3 == 1<br/>
<br/>
** xi3 : Literacy<br/>
  recode ED2 (-4/-1 = .), gen(edu_lit)<br/>
<br/>
** xi4 : Married or single?<br/>
  recode RO6 (0/1 = 1)(2/5 = 0), gen(married)<br/>
<br/>
** xi5 : Gender<br/>
  gen male   = 2 - RO3<br/>
  gen female = RO3 - 1<br/>
<br/>
** xi6 : Smoking, Drinking, Chewing<br/>
  recode TO2 TO3 TO4 (-6/-1 = .)(. = 0) (1=0) (2=1), ///<br/>
    gen(ta_smoke ta_chew ta_drink)<br/>
  gen ta_any = ta_smoke + ta_chew + ta_drink<br/>
  recode ta_any (1/3 = 1)<br/>
<br/>
la var age                 "xi1: Age"<br/>
la var age_sq              "xi1: Age Squared"<br/>
la var edu_levels          "xi2: Education level"<br/>
la var edu_current         "xi2: Currently Enrolled"<br/>
la var edu_collegegrad     "xi2: College Grad"<br/>
la var edu_anycollege      "xi2: Any college"<br/>
la var edu_lit             "xi3: Literacy"<br/>
la var married             "xi4: Married"<br/>
la var female              "xi5: Gender - Female"<br/>
la var male                "xi5: Gender - Male"<br/>
la var ta_smoke            "xi6: Tob/Acl - Smoke"<br/>
la var ta_chew             "xi6: Tob/Acl - Chew"<br/>
la var ta_drink            "xi6: Tob/Acl - Drink"<br/>
la var ta_any              "xi6: Tob/Acl - Sm/Ch/Drink"<br/>
<br/>
** xh6 : Children at home<br/>
    tempvar youngest<br/>
    egen `youngest' = min(age), by (IDHH)<br/>
    recode `youngest' (0/5 = 1) (6/200 =0), gen(nunder5)<br/>
    drop `youngest'<br/>
<br/>
***************************************************************<br/>
** 2.B INDEPENDENT VARIABLES : Spouse Variables from IL<br/>
***************************************************************<br/>
  gen PERSONIDM = PERSONID if (married == 1)<br/>
  gen spouseid1 = PERSONIDM + RO7<br/>
  gen spouseid2 = abs(PERSONIDM - RO7)<br/>
<br/>
foreach var of varlist age* edu_* work_* ta_* {<br/>
  foreach g in male female {<br/>
    gen  `g'`var' = `var' if   (`g' == 1) & (married == 1)<br/>
    egen `g'_sp_`var' = mean(`g'`var'), by(IDHH spouseid1 spouseid2)<br/>
  }<br/>
  replace male_sp_`var' = female_sp_`var' if (male == 1) & (married == 1)<br/>
  egen SP_`var'=mean(male_sp_`var'), by(IDHH RO7)<br/>
  local label : variable label `var'<br/>
  la var SP_`var' `"sp`label'"'<br/>
  drop *male*`var'<br/>
}<br/>
<br/>
<br/>
** xs1 : Spouse Education<br/>
  label values SP_edu_levels edu<br/>
<br/>
** xs2 : Spouse work<br/>
<br/>
** xs3 : Spouse Literacy<br/>
<br/>
***************************************************************<br/>
** SORT AND ORDER DATA<br/>
***************************************************************<br/>
gen EWPERSON = PERSONID<br/>
sort IDHH PERSONID<br/>
order IDHH PERSONID CASEID female male age married edu_* SP* work_*<br/>
save "dtas/individualfinal.dta", replace<br/>
<br/>
***************************************************************<br/>
** 2.C INDEPENDENT VARIABLES : Household Level<br/>
***************************************************************<br/>
use "dtas/hh.dta",clear<br/>
<br/>
** xh1 : Religion (HH pg3)<br/>
  recode ID14 (-7/-1 = .) (1 = 1 "Hindu") (2=2 "Muslim")   ///<br/>
             (3=3 "Christian")(4/9 = 4 "Other"),          ///<br/>
             gen(hh_religion) label(hh_religion)<br/>
<br/>
  recode ID13 (-7/-1 = .), gen(hh_caste)<br/>
  label values hh_caste ID13<br/>
<br/>
  ta hh_religion, gen(hh_rel)<br/>
  ta hh_caste, gen(hh_cas)<br/>
<br/>
  forv x = 1/4 {<br/>
    local rel`x' : label hh_religion `x'<br/>
    la var hh_rel`x' `"xh1: Religion - `rel`x'' "'<br/>
  }<br/>
<br/>
  forv x = 1/5 {<br/>
    local cas`x' : label hh_caste `x'<br/>
    la var hh_cas`x' `"xh1: Caste - `cas`x'' "'<br/>
  }      <br/>
<br/>
  la var hh_religion   "xh1: Religion"<br/>
  la var hh_caste      "xh1: Caste "<br/>
 <br/>
** xh2 : Urban/Rural<br/>
  recode ID9 (1 = 0) (2/3 = 1), gen(urban)<br/>
  label value urban URBAN<br/>
<br/>
** xh3 : Region<br/>
  recode STATEID (1 2 3 4 5 6 7 9 = 1 "Northern") ///<br/>
    (11 12 17 18 = 2 "Northeastern")              ///<br/>
    (10 13 14 15 16 19 20 21 = 3 "Eastern")       ///<br/>
    (8 24 25 26 27 30 = 4 "Western")              ///<br/>
    (28 29 31 32 33 34 = 5 "Southern")            ///<br/>
    (22 23 = 6 "Central"),                        ///<br/>
    gen(REGION) label(REGION)<br/>
  ta REGION, gen(REGION)<br/>
  forv x = 1/6 {<br/>
    local REG`x' : label REGION `x'<br/>
    la var REGION`x'   "xh3: Region - `REG`x'' "<br/>
  }<br/>
<br/>
** xh4 : Assets & Affluence<br/>
  gen hh_assets = HHASSETS<br/>
  quietly pca HHASSETS HHED2 HHED5ADULT COPC NADULTS INCOME<br/>
  quietly predict hh_aff1-hh_aff6, score<br/>
<br/>
  egen affcut=cut(hh_aff1), group(5)<br/>
  egen cutCOPC = cut(COPC), group(5)<br/>
  egen cutASSETS = cut(hh_assets), group(5)<br/>
<br/>
** xh5 : Main source of income<br/>
  local xh5 "xh5: HH Income -" <br/>
  recode ID15 (1 2 5 6 7 = 1 "`xh5' Business")        ///       <br/>
             (3 4 8 9   = 2 "`xh5' Wage Income")      ///      <br/>
             (10 11     = 3 "`xh5' Unearned Income"), ///      <br/>
             gen(hh_mainincome) label(hhmi)<br/>
      <br/>
la var hh_religion    "xh1: Religion"<br/>
la var hh_caste       "xh1: Caste "<br/>
la var urban          "xh2: Urban "<br/>
la var REGION         "xh3: Region "<br/>
la var hh_assets      "xh4: Household Assets "<br/>
la var INCOME5        "xh5: Income Quintile (Neg = 0)"<br/>
la var cutCOPC        "xh5: Consumption Quintile"<br/>
la var COPC           "xh5: Consumption per capita"<br/>
la var affcut         "xh5: Affluence Quintile"<br/>
la var hh_mainincome  "xh5: Primary HH Income Source "<br/>
<br/>
save "dtas/hhfinal.dta", replace<br/>
<br/>
************************************************************<br/>
** 2.D INDEPENDENT VARIABLES : Gender Relations Variables<br/>
************************************************************<br/>
clear<br/>
<br/>
use M* GR* EW3 FH1 FH2 ID* STATEID DISTNAME REGION SWEIGHT urban ///<br/>
	using "dtas/hhfinal.dta"<br/>
<br/>
*************************************************************<br/>
** 2.D.1 INDEPENDENT VARIABLES : DOMESTIC VIOLENCE<br/>
*************************************************************<br/>
<br/>
** xidv1 : BEATINGS COMMON FOR LEAVING W/OUT PERMISSION<br/>
** xidv2 : BEATINGS COMMON FOR NOT HAVING ENOUGH DOWRY<br/>
** xidv3 : BEATINGS COMMON FOR NEGLECTING HOUSE<br/>
** xidv4 : BEATINGS COMMON FOR BAD COOKING<br/>
** xidv5 : BEATINGS COMMON FOR EXTRAMARITAL RELATIONS<br/>
<br/>
local c1 "leaving"<br/>
local l1 "dv1: Leaving, no permit" <br/>
local c2 "dowry"<br/>
local l2 "dv2: Too Little Dowry"<br/>
local c3 "neglect"<br/>
local l3 "dv3: Neglecting the House"<br/>
local c4 "cooking"<br/>
local l4 "dv4: Bad Cooking"<br/>
local c5 "affair"<br/>
local l5 "dv5: Male Relations"<br/>
<br/>
forv Z = 1/4 {<br/>
    recode GR2`Z' (-1 =.)(-2 =.)(-3 =.), gen(iDV`Z'`c`Z'')<br/>
    la var iDV`Z' `"xi`l`Z'' "'<br/>
}<br/>
<br/>
gen iDVcomp = iDV1 + iDV2 +iDV3 + iDV4<br/>
recode iDVcomp (1/4=1)<br/>
   <br/>
*************************************************************<br/>
** 2.D.2 INDEPENDENT VARIABLES : DOWRY<br/>
*************************************************************<br/>
   <br/>
local A "gold"<br/>
local B "silver"<br/>
local C "land"<br/>
local D "car"<br/>
local E "scooter or motorcycle"<br/>
local F "TV"<br/>
local G "fridge"<br/>
local H "furniture"<br/>
local I "pressure cooker"<br/>
local J "utensils"<br/>
local K "mixer or grinder"<br/>
local L "bedding or mattress"<br/>
local M "watch"<br/>
local N "bicycle"<br/>
local O "sewing machine"<br/>
local P "livestock"<br/>
local Q "tractor"<br/>
local R "cash"<br/>
<br/>
local MP5let " A B C D E F G H I J K L M N O P Q R "<br/>
foreach Z in `MP5let' {<br/>
    recode MP5`Z' (-3/-1 =.)(1/2=1), gen(iMP5`Z')<br/>
    la var iMP5`Z' "xi: Dowry - ``Z''"<br/>
}<br/>
<br/>
************************************************************<br/>
** 2.D.3 INEPENDENT VARIABLES : INDEPENDENCE VARIABLES<br/>
************************************************************<br/>
<br/>
local agency1 = "GR1A GR2A GR3A GR4A GR5A GR11A GR12A GR9 GR6F " + ///<br/>
	"GR7F GR8F GR6A GR7A GR8A GR18* GR19"<br/>
local agency2 "GR20"<br/>
local agency3 "iGR9 iGR6A iGR7A iGR8A"<br/>
<br/>
recode `agency1' (-6/-1=.)(9=.)(1/3 = 1) (4/6 = 0), pre(i)<br/>
recode `agency2' (-6/-1=.)(9 = 0), pre(i)<br/>
recode `agency3' (0 = 1) (1 = 0) <br/>
<br/>
recode MH5A (1/2=1)(3/4=0)(-6/-1=.),gen(choice)<br/>
replace choice = 1 if MH5B == 1<br/>
la var choice "xm1: Marriage Choice"<br/>
<br/>
recode MH2A MH19A (-6/-1=.) (88=.) (99=.) (291=.), gen(gaunaage gaunaage2)<br/>
replace gaunaage = MH19A if gaunaage2 < gaunaage<br/>
la var gaunaage "xm2: Gauna Age"<br/>
<br/>
recode FH1 (-1=.), gen(sonsathome)<br/>
recode FH2 (-1=.), gen(dtrsathome)<br/>
gen childrenathome = sonsathome + dtrsathome<br/>
la var childrenathome "xm3: Children at Home"<br/>
<br/>
recode MH3 (-6/-1 = .)(0/1=0)(2=1) (3/5=0), gen(widow)<br/>
la var widow "xm4: Widow"<br/>
<br/>
recode GR9 (-6/-1=.) (3 = .),gen(purdah)<br/>
la var purdah "xm5: Purdah"<br/>
<br/>
gen EWPERSON = EW3<br/>
save "dtas/igrfinal.dta", replace<br/>
<br/>
**************************************************************<br/>
** 2.E REGIONAL PCA VARIABLES<br/>
**************************************************************<br/>
clear<br/>
<br/>
global vlg  "IDPSU"<br/>
global dst  "DISTNAME"<br/>
global sta  "STATEID"<br/>
global reg  "REGION"<br/>
global lvls "vlg dst sta reg"<br/>
<br/>
local DVn "2"<br/>
local DVl "Dom. Violence"<br/>
local DVc "dv"<br/>
local GRn "5"<br/>
local GRl "Gender Relations"<br/>
local GRc "gr"<br/>
local MPn "3"<br/>
local MPl "Dowry"<br/>
local MPc "d"<br/>
   <br/>
<br/>
foreach X in $lvls {<br/>
  foreach Y in DV GR MP {<br/>
    use SWEIGHT i`Y'* $`X' urban using "dtas/igrfinal.dta", clear<br/>
    save  "dtas/`X'`Y'.dta", replace <br/>
    collapse  (mean) i`Y'* (median) urban [pw=SWEIGHT], by($`X')<br/>
    quietly pca i`Y'*<br/>
    quietly predict `X'`Y'pca1-`X'`Y'pca``Y'n', score<br/>
    forv Z =1/``Y'n' {<br/>
      la var `X'~a`Z' "x`X'``Y'c': ``Y'l' Score (`X')"<br/>
    }<br/>
    if "`Y'" == "DV" & ("`X'" == "dst" | "`X'" == "vlg") {<br/>
      foreach Z in 5 25 100 {<br/>
        egen `X'DVcompall`Z' = cut(iDVcomp), group(`Z')<br/>
        egen `X'DVcompurban`Z' = cut(iDVcomp) if urban == 1, group(`Z')<br/>
        egen `X'DVcomprural`Z' = cut(iDVcomp) if urban == 0, group(`Z')<br/>
      }<br/>
    }<br/>
    drop  i`Y'*<br/>
    save  "dtas/`X'`Y'.dta", replace<br/>
  }<br/>
}<br/>
<br/>
use "dtas/igrfinal.dta"<br/>
   <br/>
foreach X in $lvls {<br/>
  foreach Y in DV GR MP {<br/>
    merge m:1 $`X' using "dtas/`X'`Y'.dta", nogen<br/>
  }<br/>
}<br/>
<br/>
save "dtas/rgrfinal.dta", replace<br/>
<br/>
*****************************************************************<br/>
** MERGE DATA<br/>
*****************************************************************<br/>
<br/>
use "dtas/individualfinal.dta", clear<br/>
merge m:1 IDHH using "dtas/hhfinal.dta", nogen<br/>
merge 1:1 IDHH EWPERSON using "dtas/igrfinal.dta", nogen<br/>
merge m:1 IDHH using "dtas/rgrfinal.dta", nogen<br/>
<br/>
** Eligible Women<br/>
   gen EW = 0<br/>
   replace EW = 1 if (EW3 == PERSONID)<br/>
   la var EW   "Eligible Women"<br/>
<br/>
local c5 "affair"<br/>
local l5 "dv5: Male Relations"<br/>
recode GR25 (-1 =.)(-2 =.)(-3 =.), gen(iDV5`c5')<br/>
la var iDV5 `"xi`l5' "'<br/>
<br/>
<br/>
svyset IDPSU [pw = SW]<br/>
/*keep if EW<br/>
keep REGION* *Religion* *Caste* *urban* hh_* SP_* cut* i* ///<br/>
choice gaunaage gaunaage2 sonsathome dtrsathome childrenathome widow purdah ///<br/>
vlg* dst* sta* reg* EW* WK* edu_* work_* *ID* DIST* SWEIGHT METRO6 INC* POOR*  ///<br/>
age* *cut* ta* PCPL COPC GROUPS8  NPERSONS NCHILDREN NTEENS NADULTS NMARRIEDF NMARRIEDM ///<br/>
*/<br/>
<br/>
save "dtas/combined.dta", replace<br/>

</code></pre>
<pre class="stata" id="IHDSRecode.do"><code>
<br/>
use "hh.dta", clear <br/>
keep GR* ID9 STATEID<br/>
<br/>
quietly {<br/>
** xh2 : Urban/Rural<br/>
			recode ID9 (1 = 0) (2/3 = 1), gen(urban)<br/>
			label define urban 0 "Rural" 1 "Urban" <br/>
			label value urban urban<br/>
<br/>
** xidv1 : BEATINGS COMMON FOR LEAVING W/OUT PERMISSION <br/>
** xidv2 : BEATINGS COMMON FOR NOT HAVING ENOUGH DOWRY<br/>
** xidv3 : BEATINGS COMMON FOR NEGLECTING HOUSE<br/>
** xidv4 : BEATINGS COMMON FOR BAD COOKING<br/>
** xidv5 : BEATINGS COMMON FOR EXTRAMARITAL RELATIONS<br/>
<br/>
local c1 "leaving"<br/>
local l1 "dv1: Leaving, no permit"		<br/>
local c2 "dowry"<br/>
local l2 "dv2: Too Little Dowry"<br/>
local c3 "neglect"<br/>
local l3 "dv3: Neglecting the House"<br/>
local c4 "cooking"<br/>
local l4 "dv4: Bad Cooking"<br/>
local c5 "affair"<br/>
local l5 "dv5: Male Relations"<br/>
<br/>
<br/>
<br/>
  forv Z = 1/5 {<br/>
			recode GR2`Z' (-1 =.)(-2 =.)(-3 =.), gen(iDV`Z'`c`Z'')<br/>
			label variable iDV`Z' `"xi`l`Z'' "'<br/>
			}<br/>
			<br/>
			gen iDVcomp = iDV1 + iDV2 + iDV3 + iDV4<br/>
			recode iDVcomp  (1/4 = 1)<br/>
			<br/>
drop GR* <br/>
<br/>
			<br/>
save "justdv.dta", replace<br/>
<br/>
merge m:1 STATEID using "IHDSStates.dta", nogen<br/>
merge m:1 code using "NFHS_census_IHDS.dta", nogen<br/>
label value code state<br/>
<br/>
foreach V of varlist iDV* {<br/>
	gen `V'_u = .<br/>
	replace `V'_u = `V' if urban == 1				 				/* Variable of only urban answers */<br/>
	gen `V'_r = .<br/>
	replace `V'_r = `V' if urban == 0								/* Variable of only rural answers */<br/>
	<br/>
	bysort code: egen tcount_`V' = count(`V')	<br/>
	gen wf_`V' = floor(women/tcount_`V')<br/>
	<br/>
	bysort code: egen ucount_`V' = count(`V'_u)<br/>
	gen wf_`V'_u = floor(urbanwomen/ucount_`V')<br/>
	<br/>
	bysort code: egen rcount_`V' = count(`V'_r)<br/>
	gen wf_`V'_r = floor(ruralwomen/rcount_`V')<br/>
	<br/>
	gen wf_`V'_ur = .<br/>
	replace wf_`V'_ur = wf_`V'_r if urban == 0<br/>
	replace wf_`V'_ur = wf_`V'_u if urban == 1<br/>
	<br/>
	gen state`V' = .<br/>
	<br/>
	forv X = 1/39 { /* For each state, calculate the mean and append state variable to include that number */<br/>
		su `V' [fw = wf_`V'_ur] if code == `X'<br/>
		replace state`V' = r(mean) if code == `X'<br/>
	}<br/>
<br/>
	egen stateu`V' = mean(`V'_u) , by(code)<br/>
	egen stater`V' = mean(`V'_r) , by(code)<br/>
	<br/>
	}<br/>
	<br/>
collapse (mean) stateiDV* stateuiDV* stateriDV* *count* , by(code)<br/>
  forv Z = 1/5 {<br/>
			label variable stateiDV`Z' `"Total `l`Z'' "'<br/>
			label variable stateuiDV`Z' `"Urban `l`Z'' "'<br/>
			label variable stateriDV`Z' `"Rural `l`Z'' "'<br/>
			}<br/>
}<br/>
save "IHDSdv.dta", replace<br/>

</code></pre>
<pre class="stata" id="NFHSRecode.do"><code>
capture log close<br/>
cd "/Users/name/Dropbox/dtas/"<br/>
clear<br/>
do "/Users/name/Dropbox/shay/do/data/IHDSRecode.do"<br/>
<br/>
use "couple_NFHS.dta", clear<br/>
quietly {<br/>
recode s025 (1/5 = 1) (6 = 0), gen(urban)<br/>
label define urban 0 "Rural" 1 "Urban" <br/>
label value urban urban<br/>
<br/>
<br/>
save "couple_NFHS2.dta", replace<br/>
merge m:1 v101 using "NFHSStates.dta", nogen<br/>
merge m:1 code using "NFHS_census_IHDS.dta", nogen<br/>
<br/>
foreach V of varlist d106 d107 d108 {<br/>
	recode `V' (8 = 0) (9 = .) 			<br/>
	}<br/>
	<br/>
gen dany = d106+d107+d108<br/>
recode dany (1/3 = 1)	<br/>
<br/>
gen dnonsex = d106+d107<br/>
recode dnonsex (1/2 = 1)	<br/>
<br/>
gen v744x = .<br/>
replace v744x = 0 if v744a==0 & v744b==0 & v744c==0 & v744d==0 & v744e==0<br/>
replace v744x = 1 if v744a==1 | v744b==1 | v744c==1 | v744d==1 | v744e==1<br/>
<br/>
gen mv744x = .<br/>
replace mv744x = 0 if mv744a==0 & mv744b==0 & mv744c==0 & mv744d==0 & mv744e==0<br/>
replace mv744x = 1 if mv744a==1 | mv744b==1 | mv744c==1 | mv744d==1 | mv744e==1<br/>
<br/>
foreach V of varlist v744* d106 d107 d108 dany dnonsex {<br/>
	recode `V' (8 = 0) (9 = .) 											/* Only "yes" means "yes" */<br/>
	gen `V'_u = .<br/>
	replace `V'_u = `V' if urban == 1				 				/* Variable of only urban answers */<br/>
	gen `V'_r = .<br/>
	replace `V'_r = `V' if urban == 0								/* Variable of only rural answers */<br/>
<br/>
	bysort v101: egen count_`V' = count(`V')	<br/>
	gen wf_`V' = floor(women/count_`V')<br/>
	<br/>
	bysort v101: egen count_`V'_u = count(`V'_u)<br/>
	gen wf_`V'_u = floor(urbanwomen/count_`V'_u)<br/>
	<br/>
	bysort v101: egen count_`V'_r = count(`V'_r)<br/>
	gen wf_`V'_r = floor(ruralwomen/count_`V'_r)<br/>
	<br/>
	gen wf_`V'_ur = .<br/>
	replace wf_`V'_ur = wf_`V'_r if urban == 0<br/>
	replace wf_`V'_ur = wf_`V'_u if urban == 1<br/>
	<br/>
	gen stateF`V' = . <br/>
	gen stateF1`V' = .<br/>
	gen stateuF`V' = .<br/>
	gen staterF`V' = .<br/>
	<br/>
	forv X = 1/39 { /* For each state, calculate the mean and append state variable to include that number */<br/>
		su `V' [fw = wf_`V'_ur] if code == `X'<br/>
		replace stateF`V' = r(mean) if code == `X'<br/>
		<br/>
		su `V' [aw = v005] if code == `X'<br/>
		replace stateF1`V' = r(mean) if code == `X'<br/>
		<br/>
		su `V' [aw = v005] if code == `X' & urban == 1<br/>
		replace stateuF`V' = r(mean) if code == `X' & urban == 1<br/>
		<br/>
		su `V' [aw = v005] if code == `X' & urban == 0<br/>
		replace staterF`V' = r(mean) if code == `X' & urban == 0		<br/>
		}<br/>
	}<br/>
	<br/>
<br/>
<br/>
	<br/>
foreach V of varlist mv744* {<br/>
	recode `V' (8 = 0) (9 = .) 											/* Only "yes" means "yes" */<br/>
	gen `V'_u = .<br/>
	replace `V'_u = `V' if urban == 1				 				/* Variable of only urban answers */<br/>
	gen `V'_r = .<br/>
	replace `V'_r = `V' if urban == 0								/* Variable of only rural answers */<br/>
<br/>
	bysort v101: egen count_`V' = count(`V')	<br/>
	gen wm_`V' = floor(men/count_`V')<br/>
		<br/>
	bysort v101: egen count_`V'_u = count(`V'_u)<br/>
	gen wm_`V'_u = floor(urbanmen/count_`V'_u)<br/>
	<br/>
	bysort v101: egen count_`V'_r = count(`V'_r)<br/>
	gen wm_`V'_r = floor(ruralmen/count_`V'_r)<br/>
	<br/>
	gen wm_`V'_ur = .<br/>
	replace wm_`V'_ur = wm_`V'_r if urban == 0<br/>
	replace wm_`V'_ur = wm_`V'_u if urban == 1<br/>
	<br/>
	gen stateM`V' = . <br/>
	gen stateM1`V' = . <br/>
	gen stateuM`V' = .<br/>
	gen staterM`V' = .<br/>
	<br/>
	forv X = 1/39 { /* For each state, calculate the mean and append state variable to include that number */<br/>
		su `V' [fw = wm_`V'_ur] if code == `X'<br/>
		replace stateM`V' = r(mean) if code == `X'<br/>
		<br/>
		su `V' [aw = mv005] if code == `X'<br/>
		replace stateM1`V' = r(mean) if code == `X'<br/>
		<br/>
		su `V' [aw = mv005] if code == `X' & urban == 1<br/>
		replace stateuM`V' = r(mean) if code == `X' & urban == 1<br/>
		<br/>
		su `V' [aw = mv005] if code == `X' & urban == 0<br/>
		replace staterM`V' = r(mean) if code == `X' & urban == 0<br/>
		}<br/>
	}<br/>
	<br/>
	collapse (mean) state* count*, by(code)<br/>
	<br/>
	<br/>
}<br/>
<br/>
save "NFHSdv.dta", replace<br/>
<br/>
merge 1:1 code using "NFHS_census_IHDS.dta", nogen<br/>
merge 1:1 code using "IHDSdv.dta", nogen<br/>
<br/>
save "DVcompare.dta",replace<br/>
do "/Users/name/Dropbox/shay/do/data/StateLabels.do"<br/>
label value code state <br/>
<br/>
expand 2, gen(totalmark)<br/>
expand 2 if totalmark == 0, gen(urbanmark)<br/>
<br/>
gen urt = urbanmark<br/>
replace urt = 3 if totalmark == 1<br/>
recode urt (0 = 2)<br/>
label define urt 1 "Urban" 2 "Rural" 3 "Total"<br/>
label value urt urt <br/>
<br/>
gen urtstate = code*100 + urt<br/>
<br/>
<br/>
<br/>
foreach Z in v744a v744b v744c v744d v744e v744x ///<br/>
							d106 d107 d108 dany dnonsex {<br/>
							<br/>
							gen `Z'_old = stateF`Z'<br/>
							replace `Z'_old = stateuF`Z' if urt == 1<br/>
							replace `Z'_old = staterF`Z' if urt == 2<br/>
							<br/>
							gen `Z' = stateF1`Z'<br/>
							replace `Z' = stateuF`Z' if urt == 1<br/>
							replace `Z' = staterF`Z' if urt == 2<br/>
							<br/>
							gen n_`Z' = count_`Z'<br/>
							replace n_`Z' = count_`Z'_r if urt == 2 <br/>
							replace n_`Z' = count_`Z'_u if urt == 1<br/>
							}<br/>
							<br/>
foreach Z in  iDV1 iDV2 iDV3 iDV4 iDV5 iDVcomp  {<br/>
							<br/>
							gen `Z' = state`Z'<br/>
							replace `Z' = stateu`Z' if urt == 1<br/>
							replace `Z' = stater`Z' if urt == 2<br/>
							<br/>
							gen n_`Z' = tcount_`Z'<br/>
							replace n_`Z' = rcount_`Z' if urt == 2 <br/>
							replace n_`Z' = ucount_`Z' if urt == 1<br/>
							}							<br/>
							<br/>
foreach Z in 	mv744a mv744b mv744c mv744d mv744e mv744x {<br/>
							<br/>
							gen `Z'_old = stateM`Z'<br/>
							replace `Z'_old = stateuM`Z' if urt == 1<br/>
							replace `Z'_old = staterM`Z' if urt == 2<br/>
							<br/>
							gen `Z' = stateM1`Z'<br/>
							replace `Z' = stateuM`Z' if urt == 1<br/>
							replace `Z' = staterM`Z' if urt == 2<br/>
							<br/>
							gen n_`Z' = count_`Z'<br/>
							replace n_`Z' = count_`Z'_r if urt == 2 <br/>
							replace n_`Z' = count_`Z'_u if urt == 1<br/>
							}<br/>
<br/>
rename *mv* *v*_m<br/>
rename  (*v744a* *v744b* *v744c* *v744d* *v744e* *v744x*) ///<br/>
				(*nDV1*  *nDV3*  *nDV5*  *nDV2*  *nDV4* *nDVcomp*)<br/>
rename n*_m nm*<br/>
rename (*dnonsex* *dany* *d106* *d107* *d108*) (*nDVns* *nDVoccured* *nDVlesssevere* *nDVsevere* *nDVsexual*)  <br/>
<br/>
gen censuspop = total<br/>
replace censuspop = rural if urt == 2<br/>
replace censuspop = urban if urt == 1<br/>
<br/>
gen censusmen = men<br/>
replace censusmen = ruralmen if urt == 2<br/>
replace censusmen = urbanmen if urt == 1<br/>
<br/>
gen censuswomen = women<br/>
replace censuswomen = ruralwomen if urt == 2<br/>
replace censuswomen = urbanwomen if urt == 1<br/>
<br/>
drop state* *count*<br/>
<br/>
gen str isocode = "."<br/>
replace isocode = "IN-AP" if code == 1<br/>
replace isocode = "IN-AR" if code == 2<br/>
replace isocode = "IN-AS" if code == 3<br/>
replace isocode = "IN-BR" if code == 4<br/>
replace isocode = "IN-CT" if code == 6<br/>
replace isocode = "IN-GA" if code == 7<br/>
replace isocode = "IN-GJ" if code == 8<br/>
replace isocode = "IN-HR" if code == 9<br/>
replace isocode = "IN-HP" if code == 10<br/>
replace isocode = "IN-JK" if code == 11<br/>
replace isocode = "IN-JH" if code == 12<br/>
replace isocode = "IN-KA" if code == 13<br/>
replace isocode = "IN-KL" if code == 14<br/>
replace isocode = "IN-MP" if code == 15<br/>
replace isocode = "IN-MH" if code == 17<br/>
replace isocode = "IN-MN" if code == 18<br/>
replace isocode = "IN-ML" if code == 19<br/>
replace isocode = "IN-MZ" if code == 20<br/>
replace isocode = "IN-NL" if code == 21<br/>
replace isocode = "IN-DL" if code == 22<br/>
replace isocode = "IN-OR" if code == 23<br/>
replace isocode = "IN-PB" if code == 24<br/>
replace isocode = "IN-RJ" if code == 25<br/>
replace isocode = "IN-SK" if code == 26<br/>
replace isocode = "IN-TN" if code == 27<br/>
replace isocode = "IN-TR" if code == 29<br/>
replace isocode = "IN-UP" if code == 30<br/>
replace isocode = "IN-UT" if code == 32<br/>
replace isocode = "IN-WB" if code == 33<br/>
replace isocode = "IN-DN" if code == 34<br/>
replace isocode = "IN-CH" if code == 35<br/>
replace isocode = "IN-DD" if code == 36<br/>
replace isocode = "IN-PY" if code == 37<br/>
<br/>
save "DVcompare.dta", replace <br/>
<br/>
<br/>

</code></pre>
<pre class="stata" id="StateLabels.do"><code>
label define state ///<br/>
38 "Andaman and Nicobar Islands"  ///<br/>
1 "Andhra Pradesh"  ///<br/>
2 "Arunachal Pradesh"  ///<br/>
3 "Assam"  ///<br/>
5 "Bihar and Jharkhand"  ///<br/>
4 "Bihar"  ///<br/>
35 "Chandigarh"  ///<br/>
6 "Chhattisgarh"  ///<br/>
34 "Dadra & Nagar Haveli"  ///<br/>
36 "Daman & Diu"  ///<br/>
7 "Goa"  ///<br/>
8 "Gujarat"  ///<br/>
9 "Haryana"  ///<br/>
10 "Himachal Pradesh"  ///<br/>
11 "Jammu & Kashmir"  ///<br/>
12 "Jharkhand"  ///<br/>
13 "Karnataka"  ///<br/>
14 "Kerala"  ///<br/>
39 "Lakshadweep"  ///<br/>
16 "Madhya Pradesh and Chhattisgarh"  ///<br/>
15 "Madhya Pradesh"  ///<br/>
17 "Maharastra"  ///<br/>
18 "Manipur"  ///<br/>
19 "Meghalaya"  ///<br/>
20 "Mizoram"  ///<br/>
21 "Nagaland"  ///<br/>
22 "NCT of Delhi"  ///<br/>
23 "Orissa"  ///<br/>
37 "Puducherry"  ///<br/>
24 "Punjab"  ///<br/>
25 "Rajasthan"  ///<br/>
26 "Sikkim"  ///<br/>
27 "Tamil Nadu"  ///<br/>
29 "Tripura"  ///<br/>
30 "Uttar Pradesh"  ///<br/>
32 "Uttarakhand"  ///<br/>
33 "West Bengal"  ///<br/>
31 "Uttar Pradesh and Utteranchal", replace<br/>
<br/>
label define isocode 1 "IN-AP", modify<br/>
label define isocode 2 "IN-AR", modify<br/>
label define isocode 3 "IN-AS", modify<br/>
label define isocode 4 "IN-BR", modify<br/>
label define isocode 6 "IN-CT", modify<br/>
label define isocode 7 "IN-GA", modify<br/>
label define isocode 8 "IN-GJ", modify<br/>
label define isocode 9 "IN-HR", modify<br/>
label define isocode 10 "IN-HP", modify<br/>
label define isocode 11 "IN-JK", modify<br/>
label define isocode 12 "IN-JH", modify<br/>
label define isocode 13 "IN-KA", modify<br/>
label define isocode 14 "IN-KL", modify<br/>
label define isocode 15 "IN-MP", modify<br/>
label define isocode 17 "IN-MH", modify<br/>
label define isocode 18 "IN-MN", modify<br/>
label define isocode 19 "IN-ML", modify<br/>
label define isocode 20 "IN-MZ", modify<br/>
label define isocode 21 "IN-NL", modify<br/>
label define isocode 22 "IN-DL", modify<br/>
label define isocode 23 "IN-OR", modify<br/>
label define isocode 24 "IN-PB", modify<br/>
label define isocode 25 "IN-RJ", modify<br/>
label define isocode 26 "IN-SK", modify<br/>
label define isocode 27 "IN-SK", modify<br/>
label define isocode 29 "IN-TR", modify<br/>
label define isocode 30 "IN-UP", modify<br/>
label define isocode 32 "IN-UT", modify<br/>
label define isocode 33 "IN-WB", modify<br/>
label define isocode 34 "IN-DN", modify<br/>
label define isocode 35 "IN-CH", modify<br/>
label define isocode 36 "IN-DD", modify<br/>
label define isocode 37 "IN-PY", modify<br/>

</code></pre></body>
